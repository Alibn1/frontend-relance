<div class="client-container">
  <button mat-raised-button color="primary" (click)="ouvrirFormulaire()">+ Ajouter un client</button>

  <form *ngIf="formVisible" [formGroup]="clientForm" class="client-form" (ngSubmit)="soumettreFormulaire()">
    <mat-card class="form-card">
      <mat-card-content>
        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Raison sociale</mat-label>
            <input matInput formControlName="raison_sociale" required>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Téléphone</mat-label>
            <input matInput formControlName="telephone">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Adresse</mat-label>
            <input matInput formControlName="adresse">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Ville</mat-label>
            <input matInput formControlName="ville">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Pays</mat-label>
            <input matInput formControlName="pays">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Responsable</mat-label>
            <input matInput formControlName="responsable">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Secteur d'activité</mat-label>
            <input matInput formControlName="secteur_activite">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Solde</mat-label>
            <input matInput type="number" formControlName="solde">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Encours autorisé</mat-label>
            <input matInput type="number" formControlName="encours_autorise">
          </mat-form-field>


          <mat-checkbox formControlName="actif">Client actif</mat-checkbox>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-raised-button color="primary" type="submit">{{ editMode ? 'Modifier' : 'Ajouter' }}</button>
        <button mat-button color="warn" type="button" (click)="annuler()">Annuler</button>
      </mat-card-actions>
    </mat-card>
  </form>

  <table mat-table [dataSource]="clients" class="mat-elevation-z2 full-width">

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let client">
        <button mat-icon-button color="primary" (click)="remplirFormulaire(client)">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="supprimerClient(client.id)">
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="code_client">
      <th mat-header-cell *matHeaderCellDef>Code</th>
      <td mat-cell *matCellDef="let client">{{ client.code_client }}</td>
    </ng-container>

    <ng-container matColumnDef="raison_sociale">
      <th mat-header-cell *matHeaderCellDef>Raison sociale</th>
      <td mat-cell *matCellDef="let client">{{ client.raison_sociale }}</td>
    </ng-container>

    <ng-container matColumnDef="email">
      <th mat-header-cell *matHeaderCellDef>Email</th>
      <td mat-cell *matCellDef="let client">{{ client.email }}</td>
    </ng-container>

    <ng-container matColumnDef="telephone">
      <th mat-header-cell *matHeaderCellDef>Téléphone</th>
      <td mat-cell *matCellDef="let client">{{ client.telephone }}</td>
    </ng-container>

    <!-- Adresse -->
    <ng-container matColumnDef="adresse">
      <th mat-header-cell *matHeaderCellDef>Adresse</th>
      <td mat-cell *matCellDef="let client">{{ client.adresse }}</td>
    </ng-container>

    <!-- Ville -->
    <ng-container matColumnDef="ville">
      <th mat-header-cell *matHeaderCellDef>Ville</th>
      <td mat-cell *matCellDef="let client">{{ client.ville }}</td>
    </ng-container>

    <!-- Pays -->
    <ng-container matColumnDef="pays">
      <th mat-header-cell *matHeaderCellDef>Pays</th>
      <td mat-cell *matCellDef="let client">{{ client.pays }}</td>
    </ng-container>

    <!-- Responsable -->
    <ng-container matColumnDef="responsable">
      <th mat-header-cell *matHeaderCellDef>Responsable</th>
      <td mat-cell *matCellDef="let client">{{ client.responsable }}</td>
    </ng-container>

    <!-- Secteur d'activité -->
    <ng-container matColumnDef="secteur_activite">
      <th mat-header-cell *matHeaderCellDef>Secteur</th>
      <td mat-cell *matCellDef="let client">{{ client.secteur_activite }}</td>
    </ng-container>

    <!-- Solde -->
    <ng-container matColumnDef="solde">
      <th mat-header-cell *matHeaderCellDef>Solde</th>
      <td mat-cell *matCellDef="let client">{{ client.solde | number:'1.0-0':'fr-FR' }}</td>
    </ng-container>

    <!-- Encours autorisé -->
    <ng-container matColumnDef="encours_autorise">
      <th mat-header-cell *matHeaderCellDef>Encours</th>
      <td mat-cell *matCellDef="let client">{{ client.encours_autorise | number:'1.0-0':'fr-FR' }}</td>
    </ng-container>

    <!-- Actif -->
    <ng-container matColumnDef="actif">
      <th mat-header-cell *matHeaderCellDef>Actif</th>
      <td mat-cell *matCellDef="let client">
        <mat-icon color="{{ client.actif ? 'primary' : 'warn' }}">
          {{ client.actif ? 'check_circle' : 'cancel' }}
        </mat-icon>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>
